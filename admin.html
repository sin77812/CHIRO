<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHIRO - 블로그 관리자 패널</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0A0A0A;
            color: #FFFFFF;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: #FF3B30;
        }

        .section {
            background: #1A1A1A;
            border: 1px solid #2A2A2A;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #A0A0A0;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: #111111;
            border: 1px solid #2A2A2A;
            border-radius: 4px;
            color: #FFFFFF;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #FF3B30;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        textarea.content {
            min-height: 300px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        button {
            background: #FF3B30;
            color: #FFFFFF;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }

        button:hover {
            background: #E6342A;
        }

        button.secondary {
            background: transparent;
            border: 1px solid #2A2A2A;
            color: #FFFFFF;
        }

        button.secondary:hover {
            background: #1A1A1A;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-btn {
            display: inline-block;
            background: #111111;
            border: 1px solid #2A2A2A;
            padding: 0.75rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-btn:hover {
            background: #1A1A1A;
        }

        .preview-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 4px;
            margin-top: 1rem;
            border: 1px solid #2A2A2A;
        }

        .blog-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .blog-item {
            background: #111111;
            border: 1px solid #2A2A2A;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .blog-item:hover {
            transform: translateY(-2px);
            border-color: #3A3A3A;
        }

        .blog-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .blog-item h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #FFFFFF;
            line-height: 1.4;
        }

        .blog-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #A0A0A0;
        }

        .blog-excerpt {
            color: #A0A0A0;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .blog-tag {
            background: #2A2A2A;
            color: #A0A0A0;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .status-active {
            color: #34C759;
        }

        .status-inactive {
            color: #FF9500;
        }

        .featured-badge {
            background: #FF3B30;
            color: #FFFFFF;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal-content {
            background: #1A1A1A;
            border: 1px solid #2A2A2A;
            border-radius: 8px;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        .modal h2 {
            color: #FF3B30;
            margin-bottom: 2rem;
        }

        .close-modal {
            float: right;
            background: none;
            border: none;
            color: #A0A0A0;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            margin: 0;
        }

        .close-modal:hover {
            color: #FFFFFF;
        }

        .success-message, .error-message {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message {
            background: rgba(52, 199, 89, 0.1);
            color: #34C759;
            border: 1px solid #34C759;
        }

        .error-message {
            background: rgba(255, 59, 48, 0.1);
            color: #FF3B30;
            border: 1px solid #FF3B30;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #111111;
            border: 1px solid #2A2A2A;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #FF3B30;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #A0A0A0;
            font-size: 0.9rem;
        }

        .markdown-help {
            background: #111111;
            border: 1px solid #2A2A2A;
            border-radius: 4px;
            padding: 1rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: #A0A0A0;
        }

        .markdown-help summary {
            cursor: pointer;
            font-weight: 500;
            color: #FF3B30;
            margin-bottom: 0.5rem;
        }

        .markdown-help code {
            background: #2A2A2A;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'JetBrains Mono', monospace;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .blog-list {
                grid-template-columns: 1fr;
            }

            .modal {
                padding: 1rem;
            }

            .modal-content {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CHIRO 블로그 관리자</h1>

        <!-- 통계 섹션 -->
        <div class="section">
            <h2 style="margin-bottom: 1rem; color: #FFFFFF;">블로그 통계</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalPosts">0</div>
                    <div class="stat-label">총 글 수</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="featuredPosts">0</div>
                    <div class="stat-label">대표 글</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activePosts">0</div>
                    <div class="stat-label">게시된 글</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="draftPosts">0</div>
                    <div class="stat-label">임시 보관함</div>
                </div>
            </div>
        </div>

        <!-- 성공/오류 메시지 -->
        <div class="success-message" id="successMessage"></div>
        <div class="error-message" id="errorMessage"></div>

        <!-- 새 블로그 글 작성 섹션 -->
        <div class="section">
            <h2 style="margin-bottom: 1rem; color: #FFFFFF;">새 블로그 글 작성</h2>
            <form id="blogForm">
                <div class="form-group">
                    <label for="title">제목 *</label>
                    <input type="text" id="title" name="title" required>
                </div>

                <div class="form-group">
                    <label for="category">카테고리 *</label>
                    <select id="category" name="category" required>
                        <option value="">선택하세요</option>
                        <option value="design">디자인</option>
                        <option value="development">개발</option>
                        <option value="marketing">마케팅</option>
                        <option value="business">비즈니스</option>
                        <option value="insights">인사이트</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="excerpt">요약 *</label>
                    <textarea id="excerpt" name="excerpt" required placeholder="블로그 글의 간단한 요약을 작성해주세요. (최대 200자 권장)"></textarea>
                </div>

                <div class="form-group">
                    <label for="content">본문 내용 * (Markdown 지원)</label>
                    <textarea id="content" name="content" class="content" required placeholder="# 제목

본문 내용을 Markdown 형식으로 작성하세요.

## 소제목

- 리스트 아이템
- 또 다른 아이템

**굵은 글씨** *기울임 글씨*

[링크](https://example.com)"></textarea>
                    
                    <details class="markdown-help">
                        <summary>Markdown 사용법 보기</summary>
                        <div style="margin-top: 0.5rem;">
                            <p><code># 제목</code> - 대제목</p>
                            <p><code>## 소제목</code> - 소제목</p>
                            <p><code>**굵은 글씨**</code> - <strong>굵은 글씨</strong></p>
                            <p><code>*기울임*</code> - <em>기울임</em></p>
                            <p><code>[링크](URL)</code> - 링크</p>
                            <p><code>- 목록</code> - 불렛 목록</p>
                            <p><code>1. 순서</code> - 숫자 목록</p>
                        </div>
                    </details>
                </div>

                <div class="form-group">
                    <label for="tags">태그 (쉼표로 구분)</label>
                    <input type="text" id="tags" name="tags" placeholder="Design, Trends, UX, Mobile">
                </div>

                <div class="form-group">
                    <label for="readTime">예상 읽기 시간</label>
                    <input type="text" id="readTime" name="readTime" placeholder="5 min read" value="5 min read">
                </div>

                <div class="form-group">
                    <label for="thumbnail">썸네일 이미지 (최대 5MB)</label>
                    <div class="file-upload">
                        <div class="file-upload-btn">이미지 선택</div>
                        <input type="file" id="thumbnail" name="thumbnail" accept="image/*">
                    </div>
                    <img id="thumbnailPreview" class="preview-image" style="display: none;">
                </div>

                <div class="form-group">
                    <label for="author">작성자</label>
                    <input type="text" id="author" name="author" value="CHIRO Team">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="featured" name="featured" style="width: auto; margin-right: 0.5rem;">
                        대표 글로 설정
                    </label>
                </div>

                <div class="form-group">
                    <label for="status">발행 상태</label>
                    <select id="status" name="status">
                        <option value="draft">임시 보관</option>
                        <option value="active">바로 발행</option>
                    </select>
                </div>

                <button type="submit">글 저장</button>
                <button type="button" class="secondary" onclick="clearForm()">초기화</button>
            </form>
        </div>

        <!-- 기존 블로그 글 목록 -->
        <div class="section">
            <h2 style="margin-bottom: 1rem; color: #FFFFFF;">블로그 글 목록</h2>
            <button onclick="refreshBlogs()" class="secondary">새로고침</button>
            <div class="blog-list" id="blogList">
                <!-- 블로그 글 목록이 여기에 동적으로 생성됩니다 -->
            </div>
        </div>
    </div>

    <!-- 편집 모달 -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeEditModal()">&times;</span>
            <h2>블로그 글 편집</h2>
            <form id="editForm">
                <input type="hidden" id="editId" name="id">
                
                <div class="form-group">
                    <label for="editTitle">제목 *</label>
                    <input type="text" id="editTitle" name="title" required>
                </div>

                <div class="form-group">
                    <label for="editCategory">카테고리 *</label>
                    <select id="editCategory" name="category" required>
                        <option value="">선택하세요</option>
                        <option value="design">디자인</option>
                        <option value="development">개발</option>
                        <option value="marketing">마케팅</option>
                        <option value="business">비즈니스</option>
                        <option value="insights">인사이트</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editExcerpt">요약 *</label>
                    <textarea id="editExcerpt" name="excerpt" required></textarea>
                </div>

                <div class="form-group">
                    <label for="editContent">본문 내용 * (Markdown 지원)</label>
                    <textarea id="editContent" name="content" class="content" required></textarea>
                </div>

                <div class="form-group">
                    <label for="editTags">태그 (쉼표로 구분)</label>
                    <input type="text" id="editTags" name="tags">
                </div>

                <div class="form-group">
                    <label for="editReadTime">예상 읽기 시간</label>
                    <input type="text" id="editReadTime" name="readTime">
                </div>

                <div class="form-group">
                    <label for="editAuthor">작성자</label>
                    <input type="text" id="editAuthor" name="author">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editFeatured" name="featured" style="width: auto; margin-right: 0.5rem;">
                        대표 글로 설정
                    </label>
                </div>

                <div class="form-group">
                    <label for="editStatus">발행 상태</label>
                    <select id="editStatus" name="status">
                        <option value="draft">임시 보관</option>
                        <option value="active">발행됨</option>
                        <option value="inactive">비공개</option>
                    </select>
                </div>

                <button type="submit">수정 완료</button>
                <button type="button" class="secondary" onclick="closeEditModal()">취소</button>
            </form>
        </div>
    </div>

    <script>
        // 블로그 데이터 관리 클래스
        class BlogManager {
            constructor() {
                this.blogs = [];
                this.loadBlogs();
            }

            // Git 저장소에서 블로그 데이터 로드
            loadBlogs() {
                try {
                    fetch('./src/data/blog.json')
                        .then(response => response.json())
                        .then(data => {
                            this.blogs = data;
                            localStorage.setItem('chiro_blog_data', JSON.stringify(data));
                            this.renderBlogs();
                            this.updateStats();
                        })
                        .catch(() => {
                            // Git 파일 로드 실패시 로컬 스토리지에서 로드
                            const stored = localStorage.getItem('chiro_blog_data');
                            if (stored) {
                                this.blogs = JSON.parse(stored);
                            }
                            this.renderBlogs();
                            this.updateStats();
                        });
                } catch (error) {
                    console.error('블로그 로드 중 오류:', error);
                    this.showError('블로그 데이터를 로드하는 중 오류가 발생했습니다.');
                }
            }

            // 블로그 데이터 저장
            saveBlogs() {
                localStorage.setItem('chiro_blog_data', JSON.stringify(this.blogs));
                this.updateGitRepository();
                
                // 메인 사이트에 변경사항 알림
                const event = new CustomEvent('blogUpdated');
                window.dispatchEvent(event);
            }

            // Git 저장소 업데이트 (시뮬레이션)
            updateGitRepository() {
                console.log('Git 저장소 업데이트:', this.blogs);
                this.showSuccess('블로그가 Git 저장소에 저장되었습니다.');
            }

            // 새 블로그 글 추가
            addBlog(data) {
                const newId = Math.max(...this.blogs.map(b => b.id), 0) + 1;
                const now = new Date().toISOString();
                const newBlog = {
                    id: newId,
                    ...data,
                    date: new Date().toISOString().split('T')[0], // YYYY-MM-DD 형식
                    createdAt: now,
                    updatedAt: now
                };
                
                this.blogs.push(newBlog);
                this.saveBlogs();
                this.renderBlogs();
                this.updateStats();
                this.showSuccess('새 블로그 글이 추가되었습니다.');
            }

            // 블로그 글 수정
            updateBlog(id, data) {
                const index = this.blogs.findIndex(b => b.id === parseInt(id));
                if (index !== -1) {
                    this.blogs[index] = { 
                        ...this.blogs[index], 
                        ...data,
                        updatedAt: new Date().toISOString()
                    };
                    this.saveBlogs();
                    this.renderBlogs();
                    this.updateStats();
                    this.showSuccess('블로그 글이 수정되었습니다.');
                }
            }

            // 블로그 글 삭제
            deleteBlog(id) {
                if (confirm('이 블로그 글을 삭제하시겠습니까?')) {
                    this.blogs = this.blogs.filter(b => b.id !== parseInt(id));
                    this.saveBlogs();
                    this.renderBlogs();
                    this.updateStats();
                    this.showSuccess('블로그 글이 삭제되었습니다.');
                }
            }

            // 블로그 목록 렌더링
            renderBlogs() {
                const container = document.getElementById('blogList');
                container.innerHTML = '';

                // 최신순으로 정렬
                const sortedBlogs = [...this.blogs].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                sortedBlogs.forEach(blog => {
                    const blogElement = document.createElement('div');
                    blogElement.className = 'blog-item';
                    blogElement.innerHTML = `
                        <img src="${blog.thumbnail || '/images/blog/placeholder.jpg'}" 
                             alt="${blog.title}" 
                             onerror="this.src='/images/blog/placeholder.jpg'">
                        <h3>${blog.title}</h3>
                        <div class="blog-meta">
                            <span>${this.getCategoryDisplayName(blog.category)}</span>
                            <span>${blog.date}</span>
                            <span>${blog.readTime}</span>
                        </div>
                        <div class="blog-excerpt">${blog.excerpt}</div>
                        <div class="blog-tags">
                            ${blog.tags ? blog.tags.map(tag => `<span class="blog-tag">${tag}</span>`).join('') : ''}
                        </div>
                        <div style="margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem;">
                            <span class="${blog.status === 'active' ? 'status-active' : blog.status === 'draft' ? 'status-inactive' : 'status-inactive'}">
                                ${blog.status === 'active' ? '발행됨' : blog.status === 'draft' ? '임시보관' : '비공개'}
                            </span>
                            ${blog.featured ? '<span class="featured-badge">대표글</span>' : ''}
                        </div>
                        <button onclick="editBlog(${blog.id})" class="secondary">편집</button>
                        <button onclick="blogManager.deleteBlog(${blog.id})" 
                                style="background: #FF3B30; margin-left: 0.5rem;">삭제</button>
                    `;
                    container.appendChild(blogElement);
                });
            }

            // 카테고리 표시명 변환
            getCategoryDisplayName(category) {
                const categoryMap = {
                    'design': '디자인',
                    'development': '개발',
                    'marketing': '마케팅',
                    'business': '비즈니스',
                    'insights': '인사이트'
                };
                return categoryMap[category] || category;
            }

            // 통계 업데이트
            updateStats() {
                const total = this.blogs.length;
                const featured = this.blogs.filter(b => b.featured).length;
                const active = this.blogs.filter(b => b.status === 'active').length;
                const draft = this.blogs.filter(b => b.status === 'draft').length;

                document.getElementById('totalPosts').textContent = total;
                document.getElementById('featuredPosts').textContent = featured;
                document.getElementById('activePosts').textContent = active;
                document.getElementById('draftPosts').textContent = draft;
            }

            // 성공 메시지 표시
            showSuccess(message) {
                const element = document.getElementById('successMessage');
                element.textContent = message;
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            }

            // 오류 메시지 표시
            showError(message) {
                const element = document.getElementById('errorMessage');
                element.textContent = message;
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            }
        }

        // 전역 블로그 매니저 인스턴스
        const blogManager = new BlogManager();

        // 이미지 업로드 처리
        function handleImageUpload(input, previewId) {
            const file = input.files[0];
            if (file) {
                // 파일 크기 확인 (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    blogManager.showError('이미지 파일은 5MB 이하여야 합니다.');
                    input.value = '';
                    return;
                }

                // 미리보기 표시
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(previewId);
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);

                // 실제로는 파일을 서버에 업로드하고 URL을 받아와야 함
                setTimeout(() => {
                    const imageUrl = `/images/blog/${file.name}`;
                    input.dataset.uploadedUrl = imageUrl;
                }, 1000);
            }
        }

        // 폼 제출 처리
        document.getElementById('blogForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const blogData = {
                title: formData.get('title'),
                category: formData.get('category'),
                excerpt: formData.get('excerpt'),
                content: formData.get('content'),
                tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
                readTime: formData.get('readTime'),
                thumbnail: document.getElementById('thumbnail').dataset.uploadedUrl || '/images/blog/placeholder.jpg',
                author: formData.get('author'),
                featured: formData.get('featured') === 'on',
                status: formData.get('status')
            };

            blogManager.addBlog(blogData);
            clearForm();
        });

        // 편집 폼 제출 처리
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const blogData = {
                title: formData.get('title'),
                category: formData.get('category'),
                excerpt: formData.get('excerpt'),
                content: formData.get('content'),
                tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
                readTime: formData.get('readTime'),
                author: formData.get('author'),
                featured: formData.get('featured') === 'on',
                status: formData.get('status')
            };

            const id = formData.get('id');
            blogManager.updateBlog(id, blogData);
            closeEditModal();
        });

        // 썸네일 이미지 업로드 처리
        document.getElementById('thumbnail').addEventListener('change', function() {
            handleImageUpload(this, 'thumbnailPreview');
        });

        // 블로그 글 편집
        function editBlog(id) {
            const blog = blogManager.blogs.find(b => b.id === id);
            if (!blog) return;

            // 편집 폼에 데이터 채우기
            document.getElementById('editId').value = blog.id;
            document.getElementById('editTitle').value = blog.title;
            document.getElementById('editCategory').value = blog.category;
            document.getElementById('editExcerpt').value = blog.excerpt;
            document.getElementById('editContent').value = blog.content;
            document.getElementById('editTags').value = Array.isArray(blog.tags) ? blog.tags.join(', ') : '';
            document.getElementById('editReadTime').value = blog.readTime || '5 min read';
            document.getElementById('editAuthor').value = blog.author || 'CHIRO Team';
            document.getElementById('editFeatured').checked = blog.featured || false;
            document.getElementById('editStatus').value = blog.status || 'draft';

            // 모달 표시
            document.getElementById('editModal').style.display = 'block';
        }

        // 편집 모달 닫기
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // 폼 초기화
        function clearForm() {
            document.getElementById('blogForm').reset();
            document.getElementById('thumbnailPreview').style.display = 'none';
            document.getElementById('thumbnail').dataset.uploadedUrl = '';
        }

        // 블로그 목록 새로고침
        function refreshBlogs() {
            blogManager.loadBlogs();
        }

        // 모달 외부 클릭시 닫기
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('editModal');
            if (e.target === modal) {
                closeEditModal();
            }
        });

        // 페이지 로드시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            blogManager.loadBlogs();
        });
    </script>
</body>
</html>